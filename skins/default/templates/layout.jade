include lib
!!! true
html
  head
    meta(http-equiv='Content-Type', content='text/html; charset=utf-8')
    title #{title} #{version} API documentation | Home
    meta(name='generator', content='ndoc')
    script(charset='utf-8', src='javascripts/jquery-1.7.min.js', type='text/javascript')
    script(charset='utf-8', src='javascripts/prettify.js', type='text/javascript')
    script(charset='utf-8', type='text/javascript')
      function hashChanged(path) {
        var el = $('div.menu-item a[href="'+path+'"]');
        //console.log('HASH', path);
        // forget current selection
        $('div.menu-item >a.current').removeClass('current');
        $('div.menu-item >a.current-parent').removeClass('current-parent');
        // collapse menu
        $('div.menu-item >ul').addClass('hidden');
        // expand parent of `el`
        el.parents('ul:eq(0)').removeClass('hidden');
        // expand children of `el`
        el.next().removeClass('hidden');
        // set current selection
        el.parents('div.menu-item').find('>a').addClass('current-parent');
        el.addClass('current');
        return false;
      }
      var onchange;
      $(document)
      // TODO: textchange?
      .delegate('#search', 'keyup', onchange = function() {
        //console.log('CH', arguments);
        var filter = $(this).val();
        // TODO: glob-style search?
        var re = new RegExp(filter, 'i');
        /*var count = 0;
        $('div.article').addClass('hidden');
        $('div.article').each(function() {
          if ($(this).attr('id').match(re)) {
            $(this).removeClass('hidden');
            ++count;
          }
        });*/
        $('div#home')[filter ? 'addClass' : 'removeClass']('hidden');
        $('div.menu-item').addClass('hidden');
        $('div.menu-item >a').each(function() {
          if ($(this).attr('href').substring(1).match(re)) {
            $(this).parents('div.menu-item').removeClass('hidden');
          }
        });
      })
      // setup menu accordion
      /*.delegate('div.menu-item >a', 'click', function() {
        //console.log('CLICK');
        //selectMenuItem($(this));
      })*/
      // setup smooth scroll for local anchors
      .delegate('a[href^="#"]', 'click', function(ev) {
        var href = $(this).attr('href');
        var el = $('[id="' + href.substring(1) + '"]');
        $('body').stop().animate({
          scrollTop: el.offset().top
        }, 500, function() {
          location.hash = href;
          hashChanged(href);
        });
        return false;
      });

    link(charset='utf-8', href='stylesheets/api.css', media='screen, projection', rel='stylesheet', type='text/css')
    link(charset='utf-8', href='stylesheets/prettify.css', media='screen, projection', rel='stylesheet', type='text/css')
    style
      .hidden { display: none !important;}
  body
    #sidebar
      form.search-ribbon
        input#search(type='search', size='20', title='Search', placeholder='Search')
      #menu_pane.sidebar-pane.scrollable
        ul#api_menu.menu-items
          mixin menu(tree)
    #page
      #toc
      #main.page-content

        #home.page-introduction!= htmlize(readme)

        mixin api(tree)

        if sections.length
          .section.section-sections
            .section-title
              h3 Sections
            .section-content
              ul.section-list
                for section in sections
                  li
                    h4
                      a(href="#{path_to(section)") #{section.name}
                    p= section.short_description

      #footer
        p
          a(href=src_code_href) #{title}
          |  #{version} API documentation.
        p
          | Last updated on #{date}
          | Generated by
          a(href='http://github.com/nodeca/ndoc') ndoc
          | .
          | Uses
          a(href='http://famfamfam.com/lab/icons/silk/', title='famfamfam.com: Silk Icons') Silk Icons
          |  and portions of
          a(href='http://github.com/280north/aristo/tree/master', title='280north\'s aristo at master - GitHub') Aristo
          | .
    script(charset='utf-8', type='text/javascript')
      $(function(){
        // setup code prettifier
        $('pre[class!=syntax] >code').addClass('prettyprint');
        $('#home pre >code').removeClass('prettyprint');
        prettyPrint();
        // honor initial hash
        hashChanged(location.href.replace(/(^.*)#/, '#'));
        //$('div.menu-item a[href="'+location.href.replace(/(^.*)#/, '#')+'"]').click();
      });
